# –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –Ø–Ω–¥–µ–∫—Å Fleet API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –±–æ—Ç–æ–º

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–ß—Ç–æ —Ç–∞–∫–æ–µ –Ø–Ω–¥–µ–∫—Å Fleet API](#—á—Ç–æ-—Ç–∞–∫–æ–µ-—è–Ω–¥–µ–∫—Å-fleet-api)
2. [–¢–µ–∫—É—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞](#—Ç–µ–∫—É—â–∏–µ-—Ñ—É–Ω–∫—Ü–∏–∏-–±–æ—Ç–∞)
3. [–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π —Å API](#—Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ-—Ñ—É–Ω–∫—Ü–∏–π-—Å-api)
4. [–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ API –º–µ—Ç–æ–¥–æ–≤](#–¥–µ—Ç–∞–ª—å–Ω–æ–µ-–æ–ø–∏—Å–∞–Ω–∏–µ-api-–º–µ—Ç–æ–¥–æ–≤)
5. [–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
6. [–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏](#–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è-–∏-–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏)
7. [–ü–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](#–ø–ª–∞–Ω-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)

---

## –ß—Ç–æ —Ç–∞–∫–æ–µ –Ø–Ω–¥–µ–∫—Å Fleet API

**–Ø–Ω–¥–µ–∫—Å Fleet API** (—Ä–∞–Ω–µ–µ –Ø–Ω–¥–µ–∫—Å.–¢–∞–∫—Å–∏ –¥–ª—è –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤) ‚Äî —ç—Ç–æ REST API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤ (—Ç–∞–∫—Å–æ–ø–∞—Ä–∫–æ–≤, –∫—É—Ä—å–µ—Ä—Å–∫–∏—Ö —Å–ª—É–∂–±) —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π –Ø–Ω–¥–µ–∫—Å.–¢–∞–∫—Å–∏.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –≤–æ–¥–∏—Ç–µ–ª–µ–π/–∫—É—Ä—å–µ—Ä–æ–≤ (–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ—Ä–æ–≤)
- –†–∞–±–æ—Ç–∞ —Å –±–∞–ª–∞–Ω—Å–∞–º–∏ (—Ç–µ–∫—É—â–∏–π, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (–Ω–∞—á–∏—Å–ª–µ–Ω–∏—è, —Å–ø–∏—Å–∞–Ω–∏—è)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è–º–∏ –∏ —Å–≤—è–∑—å—é –≤–æ–¥–∏—Ç–µ–ª—å-–∞–≤—Ç–æ–º–æ–±–∏–ª—å
- –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ –æ—Ç—á—ë—Ç–æ–≤

### –ë–∞–∑–æ–≤—ã–π URL API:
```
https://fleet-api.taxi.yandex.net
```

---

## –¢–µ–∫—É—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞

–ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞, –≤ –±–æ—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:

### 1. **–ü—Ä–æ—Å–º–æ—Ç—Ä –±–∞–ª–∞–Ω—Å–∞** (`get_balance_by_phone`)
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö**: Jump API (`jump/jump_integrations.py`)
- **–ú–µ—Ç–æ–¥**: `GET /drivers` —Å –ø–æ–∏—Å–∫–æ–º –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: –¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –≤–æ–¥–∏—Ç–µ–ª—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ `Decimal`

### 2. **–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞—Ç—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** (`get_date_lead`)
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö**: Metabase (`metabase/metabase_integration.py`)
- **–ú–µ—Ç–æ–¥**: –ó–∞–ø—Ä–æ—Å –∫ Metabase Card API
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: –î–∞—Ç–∞ –ª–∏–¥–∞ (–¥–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏) –≤ —Ñ–æ—Ä–º–∞—Ç–µ `datetime`

### 3. **–í—ã–ø–ª–∞—Ç—ã –∑–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö –¥—Ä—É–∑–µ–π** (`compute_referral_commissions_for_inviter`)
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö**: Metabase + Google Sheets
- **–õ–æ–≥–∏–∫–∞**: –ü–æ–¥—Å—á—ë—Ç –∫–æ–º–∏—Å—Å–∏–π –∑–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö –¥—Ä—É–∑–µ–π –∑–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –Ω–µ–¥–µ–ª—é
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: –°—É–º–º—É –≤—ã–ø–ª–∞—Ç –≤ —Ä—É–±–ª—è—Ö

### 4. **–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤** (`perform_withdrawal`)
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö**: Jump API
- **–ú–µ—Ç–æ–¥**: `PUT/POST /drivers/{id}/transactions`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª**: –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–∞ –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –æ—Å—Ç–∞—Ç–∫–∞ (50‚ÇΩ)

### 5. **–ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è –≤–æ–¥–∏—Ç–µ–ª—è** (`get_driver_by_phone`, `get_driver_profile`)
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö**: Jump API
- **–ú–µ—Ç–æ–¥**: `GET /drivers`, `GET /drivers/{id}`
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç**: –ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –≤–æ–¥–∏—Ç–µ–ª—è (–∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, –±–∞–ª–∞–Ω—Å, —Å—Ç–∞—Ç—É—Å –∏ —Ç.–¥.)

---

## –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π —Å API

| –¢–µ–∫—É—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –±–æ—Ç–∞ | –ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ –Ø–Ω–¥–µ–∫—Å Fleet API | Endpoint | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|---------------------|------------------------------------------|----------|-----------|
| **–ü—Ä–æ—Å–º–æ—Ç—Ä –±–∞–ª–∞–Ω—Å–∞** | `POST /v1/parks/driver-profiles/list` —Å –ø–æ–ª–µ–º `account.current.balance` | `/v1/parks/driver-profiles/list` | ‚úÖ –í—ã—Å–æ–∫–∏–π |
| **–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å** | `GET /v1/parks/contractors/blocked-balance` | `/v1/parks/contractors/blocked-balance` | ‚úÖ –í—ã—Å–æ–∫–∏–π |
| **–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** | `POST /v1/parks/driver-profiles/list` ‚Üí –ø–æ–ª–µ `driver_profile.created_date` –∏–ª–∏ `GET /v2/parks/contractors/driver-profile` ‚Üí `hire_date` | `/v1/parks/driver-profiles/list` –∏–ª–∏ `/v2/parks/contractors/driver-profile` | ‚úÖ –í—ã—Å–æ–∫–∏–π |
| **–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** | `POST /v2/parks/driver-profiles/transactions/list` | `/v2/parks/driver-profiles/transactions/list` | ‚úÖ –°—Ä–µ–¥–Ω–∏–π |
| **–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–≤—ã–≤–æ–¥)** | `POST /v3/parks/driver-profiles/transactions` | `/v3/parks/driver-profiles/transactions` | ‚úÖ –í—ã—Å–æ–∫–∏–π |
| **–ü—Ä–æ—Ñ–∏–ª—å –≤–æ–¥–∏—Ç–µ–ª—è** | `GET /v2/parks/contractors/driver-profile` | `/v2/parks/contractors/driver-profile` | ‚úÖ –í—ã—Å–æ–∫–∏–π |
| **–í—ã–ø–ª–∞—Ç—ã –∑–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤** | ‚ö†Ô∏è –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é | - | ‚ùå –¢—Ä–µ–±—É–µ—Ç –∫–∞—Å—Ç–æ–º–Ω–æ–π –ª–æ–≥–∏–∫–∏ |

---

## –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ API –º–µ—Ç–æ–¥–æ–≤

### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –≤–æ–¥–∏—Ç–µ–ª—è

#### –ú–µ—Ç–æ–¥ 1: –ß–µ—Ä–µ–∑ —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π
```http
POST /v1/parks/driver-profiles/list
Content-Type: application/json
X-API-Key: {api_key}
X-Client-ID: {client_id}
X-Park-ID: {park_id}
Accept-Language: ru

{
  "query": {
    "park": {
      "id": "{park_id}",
      "driver_profile": {
        "work_status": ["working"]
      }
    }
  },
  "fields": {
    "account": ["current"],
    "driver_profile": ["id", "created_date"]
  }
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "driver_profiles": [
    {
      "driver_profile": {
        "id": "contractor_profile_id",
        "created_date": "2024-01-15T10:30:00+00:00"
      },
      "account": {
        "current": {
          "balance": "1250.50",
          "balance_limit": "0.00",
          "currency": "RUB"
        }
      }
    }
  ]
}
```

#### –ú–µ—Ç–æ–¥ 2: –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å
```http
GET /v1/parks/contractors/blocked-balance?contractor_profile_id={contractor_id}
X-API-Key: {api_key}
X-Client-ID: {client_id}
X-Park-ID: {park_id}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "balance": "1250.50",
  "blocked_balance": "150.00",
  "blocked_details": [
    {
      "amount": "100.00",
      "reason": "tips",
      "description": "–ß–∞–µ–≤—ã–µ"
    },
    {
      "amount": "50.00",
      "reason": "bonus",
      "description": "–ë–æ–Ω—É—Å—ã"
    }
  ]
}
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –≤–æ–¥–∏—Ç–µ–ª—è

```http
GET /v2/parks/contractors/driver-profile?contractor_profile_id={contractor_id}
X-API-Key: {api_key}
X-Client-ID: {client_id}
X-Park-ID: {park_id}
Accept-Language: ru
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "contractor_profile": {
    "id": "contractor_profile_id",
    "person": {
      "full_name": {
        "first_name": "–ò–≤–∞–Ω",
        "last_name": "–ò–≤–∞–Ω–æ–≤",
        "middle_name": "–ò–≤–∞–Ω–æ–≤–∏—á"
      },
      "contact_info": {
        "phone": "+79001234567",
        "email": "ivan@example.com"
      }
    },
    "profile": {
      "hire_date": "2024-01-15",
      "work_status": "working",
      "comment": "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"
    },
    "driver_license": {
      "number": "1234567890",
      "expiry_date": "2025-12-31"
    }
  }
}
```

**–í–∞–∂–Ω—ã–µ –ø–æ–ª—è:**
- `hire_date` ‚Äî –¥–∞—Ç–∞ –Ω–∞–π–º–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –ø–∞—Ä–∫–µ
- `created_date` ‚Äî –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è (–∏–∑ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π)
- `work_status` ‚Äî —Å—Ç–∞—Ç—É—Å —Ä–∞–±–æ—Ç—ã (`working`, `not_working`, `fired`)

### 3. –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

```http
POST /v2/parks/driver-profiles/transactions/list
Content-Type: application/json
X-API-Key: {api_key}
X-Client-ID: {client_id}
X-Park-ID: {park_id}

{
  "query": {
    "park": {
      "id": "{park_id}",
      "driver_profile": {
        "id": "{contractor_profile_id}"
      },
      "transaction": {
        "event_at": {
          "from": "2024-01-01T00:00:00+00:00",
          "to": "2024-01-31T23:59:59+00:00"
        }
      }
    }
  },
  "limit": 50
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "transactions": [
    {
      "id": "transaction_id",
      "event_at": "2024-01-20T14:30:00+00:00",
      "category_id": "bonus",
      "category_name": "–ë–æ–Ω—É—Å",
      "amount": "500.00",
      "currency": "RUB",
      "description": "–ë–æ–Ω—É—Å –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤",
      "type": "payment"
    }
  ]
}
```

### 4. –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤)

```http
POST /v3/parks/driver-profiles/transactions
Content-Type: application/json
X-API-Key: {api_key}
X-Client-ID: {client_id}
X-Park-ID: {park_id}

{
  "park_id": "{park_id}",
  "driver_profile_id": "{contractor_profile_id}",
  "category_id": "withdraw",
  "amount": "1000.00",
  "currency": "RUB",
  "description": "–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤",
  "source": "api"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "id": "transaction_id",
  "status": "processing",
  "created_at": "2024-01-20T15:00:00+00:00"
}
```

### 5. –°—Ç–∞—Ç—É—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

```http
GET /v3/parks/driver-profiles/transactions/status?contractor_profile_id={contractor_id}&id={transaction_id}
X-API-Key: {api_key}
X-Client-ID: {client_id}
X-Park-ID: {park_id}
```

---

## –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

1. **`park_id`** ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–∞—Ä—Ç–Ω—ë—Ä–∞ (–ø–∞—Ä–∫–∞)
2. **`X-Client-ID`** ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞ API
3. **`X-API-Key`** ‚Äî —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á API –ø–∞—Ä—Ç–Ω—ë—Ä–∞

### –ì–¥–µ –ø–æ–ª—É—á–∏—Ç—å:
- –í –∫–∞–±–∏–Ω–µ—Ç–µ –ø–∞—Ä—Ç–Ω—ë—Ä–∞: **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí API**
- –ü—Ä–∞–≤–æ –∏–∑–º–µ–Ω—è—Ç—å –∫–ª—é—á–∏ –∏–º–µ–µ—Ç —Ç–æ–ª—å–∫–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å —Ä–æ–ª—å—é **"–î–∏—Ä–µ–∫—Ç–æ—Ä"**

### –ó–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤:
```http
X-API-Key: {–≤–∞—à_api_key}
X-Client-ID: {–≤–∞—à_client_id}
X-Park-ID: {–≤–∞—à_park_id}
Accept-Language: ru  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤
Content-Type: application/json
```

### –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–æ–≤:
- **–ú–µ—Ç–æ–¥**: HTTPS (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- **–§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö**: JSON
- **–ö–æ–¥–∏—Ä–æ–≤–∫–∞**: UTF-8

---

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### ‚ö†Ô∏è –ß—Ç–æ –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é:

1. **–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ Telegram –±–æ—Ç–µ**
   - API –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –¥–∞—Ç—É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –Ø–Ω–¥–µ–∫—Å Fleet (`hire_date`, `created_date`)
   - –î–∞—Ç–∞ –ø–µ—Ä–≤–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–æ—Ç–æ–º –¥–æ–ª–∂–Ω–∞ —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –≤–∞—à–µ–π –ë–î

2. **–í—ã–ø–ª–∞—Ç—ã –∑–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤**
   - API –Ω–µ –∏–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –≤—ã–ø–ª–∞—Ç
   - –¢—Ä–µ–±—É–µ—Ç—Å—è –∫–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏–ª–∏ –≤–Ω–µ—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö

3. **–ü–æ–∏—Å–∫ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É**
   - API –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä—è–º–æ–π –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
   - –ù—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `POST /v1/parks/driver-profiles/list` —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å `contractor_profile_id` –¥—Ä—É–≥–∏–º —Å–ø–æ—Å–æ–±–æ–º

### ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ —É—á–µ—Å—Ç—å:

1. **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞**
   - –†–∞–∑–Ω—ã–µ —Ä–æ–ª–∏ (–î–∏—Ä–µ–∫—Ç–æ—Ä, –û–ø–µ—Ä–∞—Ç–æ—Ä) –∏–º–µ—é—Ç —Ä–∞–∑–Ω—ã–µ –ø—Ä–∞–≤–∞
   - –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–µ—Ç–æ–¥—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Ä–æ–ª–µ–π

2. **–õ–∏–º–∏—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤**
   - API –º–æ–∂–µ—Ç –∏–º–µ—Ç—å rate limiting
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

3. **–§–æ—Ä–º–∞—Ç –¥–∞—Ç**
   - –î–∞—Ç—ã –≤ ISO 8601 —Ñ–æ—Ä–º–∞—Ç–µ —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–æ–Ω–æ–π
   - –ü—Ä–∏–º–µ—Ä: `2024-01-15T10:30:00+00:00`

4. **–í–∞–ª—é—Ç–∞**
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è RUB (—Ä—É–±–ª–∏)
   - –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –¥—Ä—É–≥—É—é –≤–∞–ª—é—Ç—É –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö

5. **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Accept-Language: ru` –¥–ª—è —Ä—É—Å—Å–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤
   - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: `ru`, `en` –∏ –¥—Ä—É–≥–∏–µ —è–∑—ã–∫–∏

---

## –ü–ª–∞–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
1. ‚úÖ –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –Ø–Ω–¥–µ–∫—Å Fleet API
   - –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫–∞–∫ –ø–∞—Ä—Ç–Ω—ë—Ä
   - –ü–æ–ª—É—á–∏—Ç—å `park_id`, `X-Client-ID`, `X-API-Key`
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ `.env` —Ñ–∞–π–ª

2. ‚úÖ –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
   - –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `yandex_fleet/yandex_fleet_integration.py`
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤
   - –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –≠—Ç–∞–ø 2: –ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ –≤–æ–¥–∏—Ç–µ–ª—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
   - –ú–µ—Ç–æ–¥: `POST /v1/parks/driver-profiles/list`
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
   - –í–æ–∑–≤—Ä–∞—Ç `contractor_profile_id`

2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
   - –ú–µ—Ç–æ–¥: `POST /v1/parks/driver-profiles/list` –∏–ª–∏ `GET /v1/parks/contractors/blocked-balance`
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ `balance` –∏ `blocked_balance`
   - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞—Ç—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
   - –ú–µ—Ç–æ–¥: `GET /v2/parks/contractors/driver-profile`
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ `hire_date` –∏–ª–∏ `created_date`
   - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã

### –≠—Ç–∞–ø 3: –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
   - –ú–µ—Ç–æ–¥: `POST /v2/parks/driver-profiles/transactions/list`
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–∞–º
   - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–≤—ã–≤–æ–¥)
   - –ú–µ—Ç–æ–¥: `POST /v3/parks/driver-profiles/transactions`
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—É–º–º—ã (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫)
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –≤–æ–¥–∏—Ç–µ–ª—è
   - –ú–µ—Ç–æ–¥: `GET /v2/parks/contractors/driver-profile`
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω—É–∂–Ω—ã—Ö –ø–æ–ª–µ–π

### –≠—Ç–∞–ø 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–æ–º
1. ‚úÖ –ó–∞–º–µ–Ω–∏—Ç—å –≤—ã–∑–æ–≤—ã Jump API –Ω–∞ –Ø–Ω–¥–µ–∫—Å Fleet API
   - –û–±–Ω–æ–≤–∏—Ç—å `get_balance_by_phone()` –≤ `handlers/user_handlers.py`
   - –û–±–Ω–æ–≤–∏—Ç—å `get_date_lead()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Fleet API
   - –û–±–Ω–æ–≤–∏—Ç—å `perform_withdrawal()` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Fleet API

2. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –±–æ—Ç–∞
   - –ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –±–∞–ª–∞–Ω—Å–∞
   - –ö–æ–º–∞–Ω–¥–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–æ—Ñ–∏–ª—è
   - –ö–æ–º–∞–Ω–¥–∞ –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤

3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ –≤–æ–¥–∏—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ API (401, 403, 500 –∏ —Ç.–¥.)
   - –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –≠—Ç–∞–ø 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
2. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–ø—Å–µ–≤–¥–æ–∫–æ–¥)

### –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
```python
def get_balance_by_phone_fleet(phone: str) -> Decimal:
    # 1. –ù–∞–π—Ç–∏ contractor_profile_id –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
    contractor_id = find_contractor_by_phone(phone)
    if not contractor_id:
        return Decimal(0)
    
    # 2. –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å
    response = requests.post(
        f"{BASE_URL}/v1/parks/driver-profiles/list",
        headers={
            "X-API-Key": API_KEY,
            "X-Client-ID": CLIENT_ID,
            "X-Park-ID": PARK_ID
        },
        json={
            "query": {
                "park": {"id": PARK_ID},
                "driver_profile": {"id": contractor_id}
            },
            "fields": {"account": ["current"]}
        }
    )
    
    balance = response.json()["driver_profiles"][0]["account"]["current"]["balance"]
    return Decimal(balance)
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞—Ç—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
```python
def get_registration_date_fleet(phone: str) -> Optional[datetime]:
    contractor_id = find_contractor_by_phone(phone)
    if not contractor_id:
        return None
    
    response = requests.get(
        f"{BASE_URL}/v2/parks/contractors/driver-profile",
        params={"contractor_profile_id": contractor_id},
        headers={
            "X-API-Key": API_KEY,
            "X-Client-ID": CLIENT_ID,
            "X-Park-ID": PARK_ID
        }
    )
    
    profile = response.json()["contractor_profile"]
    hire_date = profile["profile"]["hire_date"]
    return datetime.fromisoformat(hire_date)
```

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: https://fleet.taxi.yandex.ru/docs/api/ru/
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: https://fleet.taxi.yandex.ru/docs/api/ru/authorization
- **OpenAPI —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è**: –î–æ—Å—Ç—É–ø–Ω–∞ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞

---

## –í—ã–≤–æ–¥—ã

‚úÖ **–Ø–Ω–¥–µ–∫—Å Fleet API –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ñ—É–Ω–∫—Ü–∏–π –±–æ—Ç–∞:**
- –ü—Ä–æ—Å–º–æ—Ç—Ä –±–∞–ª–∞–Ω—Å–∞ ‚úÖ
- –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞—Ç—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ ‚úÖ
- –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π ‚úÖ
- –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ ‚úÖ
- –ü—Ä–æ—Ñ–∏–ª—å –≤–æ–¥–∏—Ç–µ–ª—è ‚úÖ

‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏:**
- –í—ã–ø–ª–∞—Ç—ã –∑–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ (–∫–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞)
- –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –±–æ—Ç–µ (—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ)

üìù **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. –ù–∞—á–∞—Ç—å —Å –±–∞–∑–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π (–±–∞–ª–∞–Ω—Å, –¥–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
2. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å Jump API –Ω–∞ –Ø–Ω–¥–µ–∫—Å Fleet API
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –Ω–∞ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏
4. –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
5. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å fallback –Ω–∞ —Å—Ç–∞—Ä—ã–π API –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
